# AI 로또 분석 시스템 기획서 (Agent 기반)

## 1. 프로젝트 개요

    •	프로젝트명: LottoGenie (로또 지니)
    •	목표:
    •	매주 동행복권 로또 당첨번호 자동 수집
    •	과거 데이터 기반 분석 및 다음 회차 예측 번호 생성
    •	예측 결과 저장 및 실제 당첨 이후 자동 등수 판정
    •	작동 주기: 매주 1회(토요일 추첨 직후)

시스템은 역할(Role) 기반의 Agent 협업 구조로 운영된다.

⸻

## 2. 시스템 에이전트 구성 (R&R)

### 2.1 Agent A — Collector (수집가)

역할: 최신 로또 당첨 정보 자동 수집 및 저장
주요 기능
• DB 저장 마지막 회차 확인
• 동행복권 페이지에서 최신 HTML 크롤링
• 당첨번호 및 날짜 파싱
• history 테이블에 신규 회차 정보 저장
• 신규 회차가 없으면 종료

사용 기술: HTTP 요청, BeautifulSoup, SQLite

⸻

### 2.2 Agent B — Analyst (분석가)

역할: 과거 기록 분석 및 다음 회차 예측 번호 생성
주요 기능
• history 전체 데이터 로드
• 번호 출현 빈도 분석
• 최근 미출현 번호 반영(옵션)
• 가중치 기반 번호 생성(6개 × 5게임)
• 결과를 my_predictions에 저장

사용 기술: 통계 분석, 번호 가중치 모델, 랜덤 생성

⸻

### 2.3 Agent C — Auditor (검증가)

역할: 예측 번호와 실제 당첨번호 비교 후 등수 판정
주요 기능
• 직전 회차 예측번호 로드
• 실제 history와 비교하여 등수 계산
• rank, matched_main, matched_bonus 업데이트
• 수익률 리포트 생성(옵션)

사용 기술: 집합 연산(Set), SQLite

⸻

## 3. 전체 워크플로우 (Weekly Cycle)

[Trigger] 매주 토요일 21:00 또는 수동 실행 1. Collector 실행
• DB 마지막 회차 확인 (예: 1200)
• 다음 회차(1201) HTML 수집 가능 여부 확인
• 데이터 파싱 후 history 업데이트 2. Auditor 실행
• 방금 저장된 회차(1201)의 실제 당첨번호 로드
• 예측번호와 비교 후 등수 계산
• my_predictions 업데이트 3. Analyst 실행
• 최신 데이터(1201 회차까지) 기반 분석
• 다음 회차(1202) 예측번호 5세트 생성
• DB 저장

⸻

## 4. 데이터베이스 스키마

###4.1 Table: history (당첨 내역)

컬럼 타입 설명
round_no INTEGER PK 회차 번호
num1~num6 INTEGER 메인 당첨 번호
bonus INTEGER 보너스 번호
draw_date TEXT 추첨일

⸻

### 4.2 Table: prizes (당첨금 정보)

| 컬럼         | 타입       | 설명           |
| ------------ | ---------- | -------------- |
| id           | INTEGER PK | 고유 ID        |
| round_no     | INTEGER FK | 회차 번호      |
| rank_no      | INTEGER    | 등수 (1~5)     |
| total_price  | BIGINT     | 총 당첨금      |
| winner_count | INTEGER    | 당첨자 수      |
| win_amount   | BIGINT     | 1게임당 당첨금 |

### 4.3 Table: winning_stores (1등 배출점)

| 컬럼        | 타입       | 설명             |
| ----------- | ---------- | ---------------- |
| id          | INTEGER PK | 고유 ID          |
| round_no    | INTEGER FK | 회차 번호        |
| store_name  | TEXT       | 상호명           |
| choice_type | TEXT       | 방식 (자동/수동) |
| address     | TEXT       | 소재지           |

### 4.4 Table: my_predictions (예측 번호)

컬럼 타입 설명
id INTEGER PK 고유 ID
round_no INTEGER 예측한 타깃 회차
num1~num6 INTEGER 예측 번호
matched_main INTEGER 일치한 메인 번호 수
matched_bonus INTEGER 보너스 일치 여부 (0/1)
rank TEXT 등수 (미추첨, 1등 등)
created_at TEXT 생성 시간
memo TEXT 메모 (사용자 기록)

⸻

## 5. 기능 명세 (Tool / Action)

### 5.1 fetch_lotto_data(round_no)

    •	Input: 회차 번호(Int)
    •	Process:
    •	URL 요청 (3~5초 딜레이 적용)
    •	HTML 파싱 (번호, 당첨금 정보, 1등 유형 포함)
    •	Output:
    •	번호, 날짜, 당첨금 리스트(prizes), 메타데이터(1등 자동/수동 수)

### 5.2 collect_winning_stores(round_no)

    •	Input: 회차 번호(Int)
    •	Process:
    •	당첨점 페이지 URL 요청
    •	1등 상호명, 주소, 방식 추출
    •	Output:
    •	DB `winning_stores` 테이블 저장

### 5.3 generate_numbers(history)

    •	Input: 과거 당첨 데이터(List)
    •	Process:
    •	출현 횟수 분석
    •	ML 모델 (LSTM) 기반 예측
    •	Output:
    •	예측 번호 5세트 (List)

…

## 6. 고도화 로드맵

### 6.1 예측 알고리즘 개선 (완료/진행중)

    •	출현 빈도 외 패턴 기반 분석
    •	번호 상관관계 분석
    •	ML 모델(LSTM) 도입 및 주간 자동 파인튜닝

### 6.2 데이터 확장 (완료)

    •   당첨금 통계 데이터 수집
    •   1등 명당(배출점) 데이터 수집

### 6.2 자동화 및 운영환경 고도화

    •	CLI 명령 제공
    •	python lotto.py load --from 1 --to 1200
    •	python lotto.py predict --round 1201
    •	python lotto.py check --round 1201
    •	Linux crontab 연동

### 6.3 시각화 기능 추가 (완료)

    •	pandas 기반 통계 테이블
    •	Chart.js 기반 인터랙티브 차트
    •	FastAPI 기반 웹 대시보드 구현 완료
    •	번호별 출현 빈도 차트
    •	최근 20회 번호별 출현 비율 파이 차트
    •	전체 회차 당첨 번호 흐름 산점도 (확대/축소, 드래그 탐색 가능)

⸻

## 7. 데이터 시각화 및 분석

- [x] **번호별 출현 빈도**: 전체 기간 막대 그래프 (완료)
- [x] **번호별 출현 비율**: 최근 20회차 파이 차트 (완료)
- [x] **당첨 번호 흐름**: 회차별 당첨 번호 산점도 (완료)
- [x] **역대 1등 당첨자 수**: 회차별 1등 당첨자 수 추이 선형 그래프 (완료)
  - 줌/팬 기능 지원
  - 총 누적 당첨자 수 표시

## 8. 예측 시스템 정책

- [x] **예측 번호 생성 제한 (Time Lock)**:
  - 매주 토요일 19:30 ~ 21:30 (KST) 사이에는 예측 생성 차단.
  - 해당 시간대 접근 시 알림 메시지 출력.

## 9. 운영 및 유지보수

- [x] **물리적 삭제 방지 (Soft Delete)**:
  - 회원 탈퇴 및 데이터 삭제 시 실제 데이터를 지우지 않고 `is_deleted` 플래그 처리.
  - 복구 가능성 확보 및 데이터 무결성 유지.
- [x] **1등 배출점 정보 제공**:
  - 당첨 내역 상세 화면에서 해당 회차 1등 배출점 목록(상호, 주소, 지도 링크) 제공.
- [x] **테스트 자동화**:
  - 스케줄러를 통해 매주 테스트 계정(ID 6)에 대한 자동 예측 번호 생성.

⸻

## 10. 웹 애플리케이션 기능

### 10.1 주요 페이지

- **메인 대시보드** (`/`): 최신 당첨 결과, 당첨금 정보, 사용자 예측 번호
- **분석 페이지** (`/analysis`): 번호별 출현 빈도, 최근 출현 비율, 당첨 번호 흐름 차트
- **당첨 내역** (`/history`): 역대 당첨 내역 조회 (페이징, 회차 검색)
- **당첨 상세정보** (`/history/{round_no}`): 상세 당첨 정보, 등위별 당첨금, 1등 배출점 정보
- **마이페이지** (`/mypage`): 사용자별 예측 번호 관리 (메모 기능 포함)

### 7.2 사용자 인증

- 회원가입, 로그인, 로그아웃
- JWT 기반 인증
- 회원 탈퇴 기능

### 7.3 데이터 시각화

- Chart.js 기반 인터랙티브 차트
- 전체 회차 데이터 탐색 (확대/축소, 드래그)
- 네이버 지도 연동 (1등 배출점 위치 확인)

### 7.4 UI/UX 개선 사항 (최신)

- **반응형 사이드바**: 모바일 친화적인 사이드바 메뉴, 활성화 시 메뉴 버튼 자동 숨김 처리로 시각적 간섭 최소화
- **직관적인 인증 UI**: 텍스트 대신 아이콘(User, Login, Logout)을 사용하여 헤더 공간 효율 최적화 및 시인성 개선
- **데이터 가독성 강화**: 당첨금 및 당첨자 수 등 숫자 데이터의 테이블 우측 정렬 적용, 모바일 환경에서의 테이블 가로 스크롤 지원

## 8. 요약

이 시스템은 다음 구조로 이루어진다:

역할 담당 에이전트 기능
데이터 수집 Collector 최신 회차 저장
예측 검증 Auditor 실제 당첨번호와 분석
예측 생성 Analyst 다음 회차 번호 생성

Agent 간 협력으로 수집 → 검증 → 예측 주기가 매주 자동으로 반복되는 구조이다.
